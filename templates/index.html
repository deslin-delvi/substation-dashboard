{% extends "base.html" %}

{% block content %}
<div class="row g-4">
  <!-- Left Column: Video Feed -->
  <div class="col-lg-8">
    <div class="card shadow-sm h-100">
      <div class="card-header bg-primary text-white">
        <i class="bi bi-camera-video"></i> Live Video Feed
      </div>
      <div class="card-body p-0 bg-dark">
        <div class="video-container">
          <img src="{{ url_for('video_feed') }}"
               alt="Video Feed"
               class="img-fluid w-100"
               id="video-feed">
          <div class="video-overlay">
            <span class="badge bg-danger pulse">DETECTION ACTIVE</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Right Column: Status, Relay, Activity -->
  <div class="col-lg-4">
    <!-- PPE Status Card -->
    <div class="card shadow-sm mb-4">
      <div class="card-header bg-success text-white">
        <i class="bi bi-person-check"></i> PPE Status
      </div>
      <div class="card-body">
        <div class="status-indicator mb-3" id="main-status">
          <div class="alert alert-success d-flex align-items-center" role="alert">
            <i class="bi bi-check-circle-fill me-2 fs-4"></i>
            <div>
              <strong>ALL CLEAR</strong><br>
              <small>PPE Compliance Verified</small>
            </div>
          </div>
        </div>

        <!-- PPE Items Checklist -->
        <div class="ppe-checklist">
          <div class="ppe-item" id="helmet-status">
            <i class="bi bi-circle-fill text-success"></i>
            <span>Hard Hat</span>
            <i class="bi bi-check-lg text-success ms-auto"></i>
          </div>
          <div class="ppe-item" id="vest-status">
            <i class="bi bi-circle-fill text-success"></i>
            <span>Safety Vest</span>
            <i class="bi bi-check-lg text-success ms-auto"></i>
          </div>
          <div class="ppe-item" id="gloves-status">
            <i class="bi bi-circle-fill text-success"></i>
            <span>Safety Gloves</span>
            <i class="bi bi-check-lg text-success ms-auto"></i>
          </div>
        </div>

        <div class="text-muted text-center mt-3">
          <small>Last Updated: <span id="last-updated">--:--:--</span></small>
        </div>
      </div>
    </div>

    <!-- Relay Control Card (compact) -->
    <div class="card shadow-sm mb-4">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>Relay / Gate Control</span>
        <span id="relay-status" class="status-pill">UNKNOWN</span>
      </div>
      <div class="card-body relay-status">
        <p class="mb-2">
          <strong>Mode:</strong>
          <span id="override-badge" class="status-pill override-off">AUTO MODE</span>
        </p>

        <p id="override-message" class="status-subtext mb-3">
          <!-- Last manual override message will appear here -->
        </p>

        <button id="relay-toggle-btn" class="btn btn-outline-primary w-100">
          Toggle Gate (Supervisor Override)
        </button>
      </div>
    </div>

    <!-- Activity Log Card -->
    <div class="card shadow-sm">
      <div class="card-header bg-info text-white">
        <i class="bi bi-clock-history"></i> Recent Activity
      </div>
      <div class="card-body p-0">
        <div class="event-log">
          <ul id="event-list" class="list-unstyled mb-0">
            <!-- Events loaded via JS -->
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
